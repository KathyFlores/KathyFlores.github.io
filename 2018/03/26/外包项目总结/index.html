<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Kathy Flores's Tuple"><title>外包项目总结 | Kathy's Tuple</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.3.1/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = 'https://hm.baidu.com/hm.js?' + '54643590e3281ee1a7bc77d5260618ee';
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();</script></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">外包项目总结</h1><a id="logo" href="/.">Kathy's Tuple</a><p class="description">饱食而遨游，泛若不系之舟。</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">外包项目总结</h1><div class="post-meta">Mar 26, 2018<span> | </span><span class="category"><a href="/categories/web/">web</a></span><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span><span class="post-time"><span class="post-meta-item-text"> | </span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i><span class="post-count"> 2k</span><span class="post-meta-item-text"> 字</span></span></span><span class="post-time"> | <span class="post-meta-item-icon"><i class="fa fa-hourglass-half"></i><span class="post-count"> 8</span><span class="post-meta-item-text"> 分钟</span></span></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#Goals（copy甲方的要求）"><span class="toc-number">1.</span> <span class="toc-text">Goals（copy甲方的要求）</span></a></li></ol><li class="toc-item toc-level-3"><a class="toc-link" href="#框架"><span class="toc-number"></span> <span class="toc-text">框架</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#遇到的问题"><span class="toc-number"></span> <span class="toc-text">遇到的问题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Python"><span class="toc-number">1.</span> <span class="toc-text">Python</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Templates"><span class="toc-number">2.</span> <span class="toc-text">Templates</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#JavaScript"><span class="toc-number">3.</span> <span class="toc-text">JavaScript</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#感想"><span class="toc-number"></span> <span class="toc-text">感想</span></a></li></div></div><div class="post-content"><blockquote>
<p>去年年末时脑子一抽接了个外包，甲方是浙财的大二的一个创业团队，对技术方面完全不懂，整个过程有点迷。。还好任务难度不大，主要是做一个外国人在国内求职的信息聚合网站，整个开发过程历时半个月，在此将开发过程中遇到的问题记录下来。</p>
</blockquote>
<h4 id="Goals（copy甲方的要求）"><a href="#Goals（copy甲方的要求）" class="headerlink" title="Goals（copy甲方的要求）"></a>Goals（copy甲方的要求）</h4><ol>
<li><p>收集应聘者的个人资料，包括自我简介、简历以及自我介绍的视频。网站上有上传文本和视频的功能，应聘者可以自行上传资料，后台自动打包保存在服务器里。为了保证人才的质量，后台需具备人工筛选的功能，符合最低要求的简历和处理过视频内敏感信息的视频会由后台再放在网站上，供客户浏览挑选。如果有符合客户要求的应聘者的资料，客户可以选择信息的收藏和下载。这是一个收集信息再放出信息的过程。</p>
<p>以下是一些具体细节：</p>
<ul>
<li>上传：应聘者通过网站自带模版填写相应的简介后保存，大致包括姓名、性别、年龄、国籍、学历、专业、意向岗位等，并上传简历和视频。自我介绍的视频时长不超过2分钟，格式要求mp4（或者方便网页使用的）。简历以word或者pdf形式上传。</li>
<li>视频观看：后台先筛选之后才能放在平台上供客户查看，视频播放中有播放进度控制按钮、暂停键和全屏与缩小选项。</li>
<li>检索：需要设计一个检索，将应聘者按地区，国籍进行分类，同时也应该有一个搜索栏，可以直接搜索国籍地区，用于方便客户查找。对留学生信息的检索。设置洲和国家二级栏目。</li>
</ul>
</li>
<li><p>网站还要能放上企业的招聘公告，这是雇主与雇员双方信息交互的过程。招聘公告通过岗位分类，也可以通过岗位进行检索。网站界面上还应设置公示栏，公开宣布企业与雇员配对成功的案例，以此来振奋人心，吸引人气！</p>
</li>
</ol>
<h3 id="框架"><a href="#框架" class="headerlink" title="框架"></a>框架</h3><p>​    Django1.8 + python3</p>
<h3 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h3><ol>
<li><p>采用默认用户认证系统条件下创建两种用户类型</p>
<ul>
<li><p>参照<a href="https://stackoverflow.com/questions/9650133/django-multiple-user-profiles" target="_blank" rel="noopener">stackoverflow</a>的回答，首先自定义一个UserProfile类</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth.models <span class="keyword">import</span> AbstractUser</span><br><span class="line"><span class="keyword">from</span> django.db.models.signals <span class="keyword">import</span> post_save</span><br><span class="line"><span class="keyword">from</span> django.utils.translation <span class="keyword">import</span> ugettext_lazy <span class="keyword">as</span> _</span><br><span class="line"><span class="comment"># Create your models here.</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserProfile</span><span class="params">(AbstractUser)</span>:</span></span><br><span class="line">    USER_TYPE = ((<span class="number">0</span>,<span class="string">'Jobseeker'</span>),(<span class="number">1</span>,<span class="string">'Employer'</span>))</span><br><span class="line">    isEmployer = models.BooleanField(choices=USER_TYPE,default=<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>接着定义两种用户类型，其中一个字段是与UserProfile一一映射</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Jobseeker</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    user = models.OneToOneField(UserProfile, on_delete=models.CASCADE, primary_key=<span class="keyword">True</span>)</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employer</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    user = models.OneToOneField(UserProfile, on_delete=models.CASCADE, primary_key=<span class="keyword">True</span>)</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
</li>
<li><p>⚠️注意：要将settings.py中的用户类型修改为UserProfile</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AUTH_USER_MODEL = <span class="string">'accounts.UserProfile'</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>修改注册的form：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> forms</span><br><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> transaction</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth.forms <span class="keyword">import</span> UserCreationForm,</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> UserProfile,Jobseeker,Employer</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SignupForm</span><span class="params">(UserCreationForm)</span>:</span></span><br><span class="line">    typechoice=forms.ChoiceField(label=_(<span class="string">'User Type'</span>),choices=((<span class="number">0</span>,_(<span class="string">'Jobseeker'</span>)),(<span class="number">1</span>,_(<span class="string">'Employer'</span>))),widget=forms.RadioSelect)</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = UserProfile</span><br><span class="line">        fields = (<span class="string">'username'</span>,<span class="string">'email'</span>,<span class="string">'password1'</span>,<span class="string">'password2'</span>)</span><br><span class="line"><span class="meta">    @transaction.atomic</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">save</span><span class="params">(self)</span>:</span></span><br><span class="line">        user = super().save(commit=<span class="keyword">False</span>)</span><br><span class="line">        user.isEmployer=int(self.cleaned_data.get(<span class="string">'typechoice'</span>))</span><br><span class="line">        <span class="comment">#print(type(user.isEmployer))</span></span><br><span class="line">        user.save()</span><br><span class="line">        <span class="keyword">if</span> user.isEmployer:</span><br><span class="line">            Employer.objects.create(user=user)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            Jobseeker.objects.create(user=user)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> user</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>国际化</p>
<ul>
<li><p>参照<a href="https://code.ziqiangxuetang.com/django/django-internationalization.html" target="_blank" rel="noopener">自强学堂</a>和<a href="https://docs.djangoproject.com/en/1.8/topics/i18n/" target="_blank" rel="noopener">django文档</a></p>
</li>
<li><p>//Mac上配置gettext（参照<a href="https://stackoverflow.com/questions/27220052/django-i18n-make-sure-you-have-gnu-gettext-tools" target="_blank" rel="noopener">stackoverflow</a>）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">brew install gettext</span><br><span class="line">brew link gettext --force</span><br></pre></td></tr></table></figure>
<p>ps.第二句不安全，本应按照高赞回答来的，但是为了省事还是选择了不安全的做法……</p>
</li>
<li><p>在settings.py中进行如下设置：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">MIDDLEWARE_CLASSES = ( </span><br><span class="line">    ...</span><br><span class="line">    <span class="string">'django.middleware.locale.LocaleMiddleware'</span>,</span><br><span class="line">    ...</span><br><span class="line">)</span><br><span class="line">...</span><br><span class="line">TEMPLATES = [</span><br><span class="line">    &#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="string">'OPTIONS'</span>: &#123;</span><br><span class="line">            <span class="string">'context_processors'</span>: [</span><br><span class="line">                </span><br><span class="line">                <span class="string">'django.template.context_processors.debug'</span>,</span><br><span class="line">                <span class="string">'django.template.context_processors.request'</span>,</span><br><span class="line">                <span class="string">'django.template.context_processors.media'</span>,</span><br><span class="line">                <span class="string">'django.contrib.auth.context_processors.auth'</span>,</span><br><span class="line">                <span class="string">'django.contrib.messages.context_processors.messages'</span>,</span><br><span class="line">                <span class="string">'django.core.context_processors.i18n'</span>, <span class="comment"># 重点是这个</span></span><br><span class="line">            ],</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">]</span><br><span class="line">LANGUAGE_CODE = <span class="string">'zh-hans'</span></span><br><span class="line"></span><br><span class="line">TIME_ZONE = <span class="string">'Asia/Shanghai'</span></span><br><span class="line"></span><br><span class="line">USE_I18N = <span class="keyword">True</span></span><br><span class="line"></span><br><span class="line">USE_L10N = <span class="keyword">True</span></span><br><span class="line"></span><br><span class="line">USE_TZ = <span class="keyword">True</span></span><br><span class="line">LANGUAGES = (</span><br><span class="line">    (<span class="string">'en'</span>, _(<span class="string">'English'</span>)),</span><br><span class="line">    (<span class="string">'zh-cn'</span>, _(<span class="string">'Chinese'</span>)),</span><br><span class="line">    </span><br><span class="line">)</span><br><span class="line">LOCALE_PATHS = (</span><br><span class="line">    os.path.join(BASE_DIR, <span class="string">'locale'</span>),</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
</li>
<li><p>开发过程中的翻译</p>
<p>在urls.py中加入：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">	url(<span class="string">r'^i18n/'</span>, include(<span class="string">'django.conf.urls.i18n'</span>)),</span><br><span class="line">  	...</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h4 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h4><p>import ugettext_lazy（不知道为啥起初我试ugettext就不起作用），需要翻译的字符串用_()包裹</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.utils.translation <span class="keyword">import</span> ugettext_lazy <span class="keyword">as</span> _</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Job</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    typeChoices = (</span><br><span class="line">        (<span class="string">'Fulltime'</span>,_(<span class="string">'Full Time'</span>)),</span><br><span class="line">        (<span class="string">'Parttime'</span>,_(<span class="string">'Part Time'</span>)),</span><br><span class="line">        (<span class="string">'Intern'</span>,_(<span class="string">'Intern'</span>)),</span><br><span class="line">        (<span class="string">'Freelance'</span>,_(<span class="string">'Freelance'</span>)),</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>
<h4 id="Templates"><a href="#Templates" class="headerlink" title="Templates"></a>Templates</h4><p>每个模板（注意是每个）前都加上</p>
<figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"></span><span class="template-tag">&#123;% <span class="name"><span class="name">load</span></span> i18n %&#125;</span><span class="xml"></span></span><br></pre></td></tr></table></figure>
<p>需要翻译的字符串使用&#123; % trans % &#125;标签包裹</p>
<figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"></span><span class="template-tag">&#123;% <span class="name"><span class="name">trans</span></span> 'Job Type' %&#125;</span><span class="xml"></span></span><br></pre></td></tr></table></figure>
<h4 id="JavaScript"><a href="#JavaScript" class="headerlink" title="JavaScript"></a>JavaScript</h4><p>在根目录的urls.py下加入</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.views.i18n <span class="keyword">import</span> javascript_catalog</span><br><span class="line"></span><br><span class="line">js_info_dict = &#123;</span><br><span class="line">    <span class="string">'packages'</span>: (<span class="string">'jobsite'</span>,),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">urlpatterns += [</span><br><span class="line">    url(<span class="string">r'^jsi18n/$'</span>, javascript_catalog, js_info_dict, name=<span class="string">"js_catalog"</span>),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>然后在需要翻译的页面中加入</p>
<figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"</span></span></span><span class="template-tag">&#123;% <span class="name"><span class="name">url</span></span> 'js_catalog' %&#125;</span><span class="xml"><span class="tag"><span class="string">"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>待翻译的字符串用gettext()函数包裹</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params">json</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(json);</span><br><span class="line">  <span class="keyword">if</span> (json[<span class="string">'res'</span>] == <span class="number">1</span>) &#123;</span><br><span class="line">    $(<span class="string">'#modalContent'</span>).text(gettext(<span class="string">"Successfully applied!"</span>));</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (json[<span class="string">'res'</span>] == <span class="number">0</span>) &#123;</span><br><span class="line">    $(<span class="string">'#modalContent'</span>).text(gettext(<span class="string">"You should log in first!"</span>));</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (json[<span class="string">'res'</span>] == <span class="number">2</span>) &#123;</span><br><span class="line">    $(<span class="string">'#modalContent'</span>).text(gettext(<span class="string">"You have applied for this job first!"</span>));</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (json[<span class="string">'res'</span>] == <span class="number">3</span>) &#123;</span><br><span class="line">    $(<span class="string">'#modalContent'</span>).text(gettext(<span class="string">"Your information has not been reviewed!"</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
</li>
<li><p>生成.po。</p>
<p>⚠️：中文一定要用zh_Hans，zh-cn、zh_CN、zh-hans等都是不对的（不过我也不知道为什么在本地开发时使用zh_hans也是ok的）。</p>
<p>后面加上-i venv是防止将虚拟运行环境中的待翻译字符串也一并加载进来</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python3 manage.py makemessages -l zh_Hans -i venv</span><br><span class="line">python3 manage.py makemessages -l en -i venv</span><br></pre></td></tr></table></figure>
<p>第一次创建目录以后再生成就可以不用这么麻烦了，直接</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 manage.py makemessages -a -i venv</span><br></pre></td></tr></table></figure>
<p>但对于js，以上命令不适用，应使用</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 manage.py makemessages -e html,js -d djangojs -i venv</span><br></pre></td></tr></table></figure>
</li>
<li><p>在locale目录下生成的.po文件中进行翻译，比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#: jobsite/templates/jobsite/base.html:94</span><br><span class="line">msgid &quot;Home&quot;</span><br><span class="line">msgstr &quot;主页&quot;</span><br></pre></td></tr></table></figure>
<p>⚠️：包含#, fuzzy的词条不会正常翻译，应手动更改后删除#, fuzzy。</p>
</li>
<li><p>编译生成的.po</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 manage.py compilemessages</span><br></pre></td></tr></table></figure>
<p>编译好以后应该可以正常显示了</p>
</li>
<li><p>留出一个切换语言的接口</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">"form-inline"</span> <span class="attr">name</span>=<span class="string">"langform"</span> <span class="attr">id</span>=<span class="string">"langform"</span> <span class="attr">method</span>=<span class="string">'post'</span>&gt;</span></span><br><span class="line">  &#123;% csrf_token %&#125;</span><br><span class="line">  <span class="tag">&lt;<span class="name">select</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">id</span>=<span class="string">"language"</span> <span class="attr">name</span>=<span class="string">"language"</span> <span class="attr">onchange</span>=<span class="string">"selectdo(this)"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"1"</span> &gt;</span>Language: </span><br><span class="line">      &#123;% get_language_info for LANGUAGE_CODE as lang %&#125;</span><br><span class="line">      &#123;&#123; lang.name_local &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    &#123;% for lang in LANGUAGES %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"&#123;&#123; lang.0 &#125;&#125;"</span> &gt;</span> &#123;&#123; lang.1 &#125;&#125;<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">  <span class="function"><span class="keyword">function</span> <span class="title">selectdo</span>(<span class="params">obj</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    str = <span class="string">"/i18n/setlang/"</span>;</span></span><br><span class="line"><span class="javascript">    myform = <span class="built_in">document</span>.getElementById(<span class="string">'langform'</span>);</span></span><br><span class="line"><span class="javascript">    myform.method = <span class="string">"POST"</span>;</span></span><br><span class="line"><span class="undefined">    myform.action = str;</span></span><br><span class="line"><span class="undefined">    myform.submit();</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>部署到服务器时发现无法访问静态文件，在urls.py中加入</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.conf <span class="keyword">import</span> settings</span><br><span class="line">urlpatterns += static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT) + static(settings.STATIC_URL, document_root=settings.STATIC_ROOT)</span><br></pre></td></tr></table></figure>
<p>同时在/etc/nginx/sites-available/目录下添加ywzy.conf：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>      <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> localhost;</span><br><span class="line">    <span class="attribute">charset</span>     utf-<span class="number">8</span>;</span><br><span class="line">        </span><br><span class="line">    <span class="attribute">client_max_body_size</span> <span class="number">2G</span>;</span><br><span class="line">    <span class="attribute">keepalive_timeout</span> <span class="number">5</span>;</span><br><span class="line">    <span class="attribute">location</span> /media  &#123;</span><br><span class="line">        <span class="attribute">alias</span> /var/www/html/ywzy/media;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="attribute">location</span> /static &#123;</span><br><span class="line">        <span class="attribute">alias</span> /var/www/html/ywzy/static;</span><br><span class="line">    &#125; </span><br><span class="line">    </span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span>  http://127.0.0.1:8001;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        <span class="attribute">include</span>     /etc/nginx/uwsgi_params;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后链接至启用站点目录下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo ln -s /etc/nginx/sites-available/ywzy.conf /etc/nginx/sites-enabled/ywzy.conf</span><br><span class="line">rm /etc/nginx/sites-enables/default</span><br></pre></td></tr></table></figure>
<p>重启nginx</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service nginx restart</span><br></pre></td></tr></table></figure>
</li>
<li><p>部署的过程中尝试了uwsgi（自强学堂推荐的），但不知道为什么总是报错，就用了gunicorn替代（这里gevent需要pip安装一下）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gunicorn --chdir /var/www/html/ywzy --pythonpath venv/ --worker-class=gevent -b0.0.0.0:8001 -w4 ywzy.wsgi:application</span><br></pre></td></tr></table></figure>
<p>管理进程也尝试了supervisor，但发现不支持pyhton3…于是使用nohup，日志记录在nohup.out中</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup gunicorn --chdir /var/www/html/ywzy --pythonpath venv/ --worker-class=gevent -b0.0.0.0:8001 -w4 ywzy.wsgi:application&amp;</span><br></pre></td></tr></table></figure>
</li>
<li><p>服务器部署阶段还遇到了关于python版本和pip版本不对的问题。。。再加上有虚拟运行环境，这类问题频繁出现，最后发现只要保证启用虚拟运行环境以后运行python使用python3命令，运行pip使用pip3命令，大部分问题都能解决，面向google编程……</p>
</li>
</ol>
<h3 id="感想"><a href="#感想" class="headerlink" title="感想"></a>感想</h3><p>​    我还是太菜了……本以为能很快做完的……看来还需要努力</p>
</div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>KathyFlores</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="/2018/03/26/外包项目总结/">http://blog.kathyf3.com/2018/03/26/外包项目总结/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>The author owns the copyright, please indicate the source reproduced.</li></ul></div><br><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a class="article-share-link" data-url="http://blog.kathyf3.com/2018/03/26/外包项目总结/" data-id="cjqgam9r50011y0txor2y20xw" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACLklEQVR42u3aMY7DMAwF0dz/0k6bxsp80i5EjauFs7H0HIAgRX4++Lp+rvT/19/6/TRdJb5kyJCxLeNaXutt1XhrwPr+7YoyZMg4gMGXXAfi2p3aujJkyJBBHrfeKFl+fUeGDBkyaow0ceTFcOd1yJAh4wQGKWLJ5oKFSy/ogVpchgwZGzL6x2Tv/f1Kf0OGDBlbMa7wSgNu+oTirmTIkDGawQNc7Sifl8EkifyzHxkyZBzDIAf3aagl6Wat2Rn0MWTIkLEtIw2j6UFYmvDxJsFthitDhoyhjLR0rAXQ2pgFSh9lyJAxmtFpBvTbjZ2E8oHMV4YMGVsx3huk6JTN8VCFDBkyRjP6aRyff+jv4c9YhgwZMg5g1FoFwdEYThCLjQcZMmQMZfTLTp4s1gbFUMooQ4aMoQzeSkyLVf46+mmoDBkyTmB0mgG1rfP0MR62kCFDxlBGZ+G0AK41QR+L7jJkyNicwduKaeJIhjB4IA56GjJkyBjB4Bvlj+ZL8hX5pzJkyJjKIIf7hEE2zVeJ26syZMg4gFE7COODXLWXEk+LyJAh40jGA1lnGIJ5KhkEXBkyZGzLuMKLzznwwzXeLkW/gwwZMsYxasGufzDHX02asMqQIWMqo99iTKcg0vI4bl7KkCFjKCM9su+E4E4BfLuiDBkyZJS2mCaIrTJVhgwZMh5tFdTapX+eL0OGjAMYfMQhBaSjG8VkVIYMGaMZT+Vd/D4JrJ1kVIYMGYMYXxrlA/ELOSHJAAAAAElFTkSuQmCC">分享</a><div class="tags"><a href="/tags/web/">web</a></div><div class="post-nav"><a class="pre" href="/2018/03/28/2018网易春招前端实习笔试/">2018网易春招前端实习笔试</a><a class="next" href="/2018/02/20/博客搭建-material主题下评论系统完善/">博客搭建-material主题下评论系统完善</a></div><div id="container"></div><link rel="stylesheet" type="text/css" href="//unpkg.com/gitalk/dist/gitalk.css?v=0.0.0"><script type="text/javascript" src="//cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.js?v=0.0.0"></script><script type="text/javascript" src="//unpkg.com/gitalk/dist/gitalk.min.js?v=0.0.0"></script><script>var gitalk = new Gitalk({
  clientID: '13ccc096aa6286ef098a',
  clientSecret: '7a77d4a088ec72639c617d913218a4fe15d2f003',
  repo: 'KathyFlores.github.io',
  owner: 'KathyFlores',
  admin: ['KathyFlores'],
  id: md5(location.pathname),
  distractionFreeMode: false
})
gitalk.render('container')
</script></div></div></div><div class="pure-u-1 pure-u-md-1-4"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/PHP/">PHP</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/android/">android</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/blog/">blog</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/verilog/">verilog</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/">web</a><span class="category-list-count">6</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/web/" style="font-size: 15px;">web</a> <a href="/tags/verilog/" style="font-size: 15px;">verilog</a> <a href="/tags/PHP/" style="font-size: 15px;">PHP</a> <a href="/tags/blog/" style="font-size: 15px;">blog</a> <a href="/tags/android/" style="font-size: 15px;">android</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/01/02/深入理解Android学习笔记2019-1-2/">深入理解Android学习笔记2019/1/2</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/01/深入理解Android学习笔记2019-1-1/">深入理解Android学习笔记2019/1/1</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/07/2019秋招阿里前端一面回忆/">2019秋招阿里前端一面回忆</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04/26/2018阿里春招前端实习面试总结/">2018阿里春招前端实习面试总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04/26/2018有赞春招前端实习面试总结/">2018有赞春招前端实习面试总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04/20/vivado综合不动的解决过程/">vivado综合不动的解决过程</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://www.cnblogs.com/YuNanlong/" title="大兔崽子" target="_blank">大兔崽子</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2019 <a href="/." rel="nofollow">Kathy's Tuple.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>